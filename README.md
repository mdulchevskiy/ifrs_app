# IFRS 9

Данное приложение создано для расчета основных показателей модели ожидаемых кредитных убытков согласно требованиям МСФО 
9: PD, LGD и CCF. Приложение состоит из трех страниц: главная страница, на которой происходит работа с базой данных и 
непосредственно расчёт показателей, страница с детализированной информацией по выбранному портфелю, а также страница с 
накопленной информацией о показателях ECL модели.

## Description

Все данные на скриншотах были предварительно удалены.

- на главной странице приложения располагается блок для расчета и вывода показателей, а также блок для работы с базой 
данных, в котором отображается информация о загруженных портфелях и функционал по добавлению новых портфелей в БД;

<p align="center">
    <img src="censored_screenshots/home_page_1.png" width="400"/> 
    <img src="censored_screenshots/home_page_2.png" width="400"/>
</p>

- приложение предполагает работу с подготовленными данными определенной структуры, поэтому на этапе загрузки портфеля в 
БД портфель проходит ряд проверок на валидность, которые разбиты на два этапа:
  
  1 этап. Этап валидации файла (портфеля) до его чтения:
  * проверка выбора файла. Для загрузки портфеля он должен быть выбран в форме загрузки файла;
  * проверка типа файла. По умолчанию предусмотрена поддержка книги excel (".xlsx") и двоичной книги excel (".xlsb");
  * проверка имени файла. Имя файла должно соответствовать паттерну "RCP 01.[01-12].20[00-99]";
  * проверка даты в имени файла. Дата в имени файла не должна быть больше текущей даты;
  * проверка размера файла. Размер файла не должен превышать лимит, установленный в настройках;
  * проверка существования в БД. Если в БД существует таблица с именем файла, файл не будет загружен.
  
  2 этап. Этап валидации портфеля после прочтения:
  * проверка количества строк. Количество строк в портфеле должно быть больше заданного в настройках минимума;
  * проверка количества столбцов. Количество столбцов в портфеле должно соответствовать количеству, указанному в настройках;
  * проверка типов данных. Типы данных в портфеле должны соответствовать заданным в настройках типам данных.
  
  Если портфель прошел валидацию на первом этапе, он копируется в директорию "\django_src\media" для дальнейшего чтения. 
  Если файл прошел валидацию на двух этапах, он записывается в базу данных. По окончании работы с файлом, он удаляется 
  из директории "\django_src\media". В зависимости от результата загрузки портфеля на главной странице выводится 
  соответствующее уведомление. При успешной загрузке в блоке базы данных появится новая запись с информацией об имени 
  портфеля (таблицы), размере портфеля (строки х столбцы) и дате загрузки;
  
<p align="center">
    <img src="censored_screenshots/uploading_1.png" width="400"/> 
    <img src="censored_screenshots/uploading_2.png" width="400"/>
</p> 
  
- чтобы посмотреть детализированную информацию о портфеле, необходимо перейти на его страницу, что можно сделать в блоке 
базы данных по клику на соответствующее название. На странице портфеля дублируется информация о размере, имени и дате 
загрузки портфеля, а также указывается его ID в базе данных. Помимо общей информации о портфеле на странице выводятся его 
первые и последние пять строк. Также присутствует возможность удалить портфель из БД или загрузить портфель в CSV 
(разделитель табуляция). При загрузке портфеля он будет сохранен в директорию "\django_src\chunk" и автоматически открыт 
в Excel;

<p align="center">
    <img src="censored_screenshots/rcp_page.png" width="400"/> 
    <img src="censored_screenshots/deleting_1.png" width="400"/>
</p> 

- для осуществления расчета определенного показателя необходимо выбрать его в поле "IFRS component". Возможен расчет как 
одного показателя, так и всех сразу (опция "All"). Далее необходимо выбрать отчетную дату в поле "Report date". После того 
как был выбран показатель и отчетная дата, необходимо нажать кнопку "Calculate". Примерное время расчета всех показателей: 
30-60 минут. В результате расчетов данные о показателях на выбранную дату будут добавлены в базу данных, а на главной 
странице отобразится уведомление об успешном окончании расчетов. В случае, когда для расчета показателей на выбранную дату 
не хватает загруженных портфелей, будет выведено соответствующее уведомление c перечнем недостающих портфелей;

<p align="center">
    <img src="censored_screenshots/calculating_1.png" width="200"/> 
    <img src="censored_screenshots/calculating_2.png" width="200"/> 
    <img src="censored_screenshots/calculating_3.png" width="200"/> 
    <img src="censored_screenshots/calculating_4.png" width="200"/>
</p>

- для просмотра значений PD, LGD и CCF следует нажать на кнопку "Show IFRS data". На странице присутствуют кнопки "Delete" 
с возможностью удаления информации на выбранную дату. При удалении информации будет выведено соответствующее уведомление;

<p align="center">
    <img src="censored_screenshots/ifrs_page_1.png" width="400"/> 
    <img src="censored_screenshots/ifrs_page_2.png" width="400"/>
</p> 

- на случай возможных сбоев при загрузке портфелей, в результате которых в директории "\django_src\media" могут оставаться 
файлы, а в базе данных могут появляться расхождения между загруженными портфелями и логами их загрузки, а также для очистки 
директории "\django_src\chunk", при запуске приложения выполняются функции, которые очищают директории и синхронизируют 
логи загрузки с фактически загруженными данными;

- поскольку приложение создавалась для использования пользователями без опыта работы с python и командной строкой, его 
запуск был реализован через скрипт "run_server.py", который запускает локальный сервер и автоматически открывает страницу 
с приложением в браузере.

## Getting Started
1. Installing virtualenv

   ```
   pip install virtualenv
   ```
2. Start a new virtual environment
   * Create
   
     ```
     unix:    virtualenv -p python3 .venv
     windows: virtualenv .venv
     ```
   * Activate
   
     ```
     unix:    source .venv/bin/activate
     windows: .venv\Scripts\activate
     ```
   * Deactivate
   
     ```
     deactivate
     ```
4. Installing packages

   ```
   pip install -r requirements.txt
   ```
5. Run Server

   ```
   python manage.py runserver
   python run_server.py
   ```